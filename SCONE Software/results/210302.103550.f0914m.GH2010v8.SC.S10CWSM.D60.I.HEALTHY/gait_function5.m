%clear previous values
clear;
close all;

%% READ EXCEL FILE
table = readtable('Torque_Gait.xlsx');
torque_ = table2array(table);
torque_=-torque_;
torque = torque_;
l = length(torque_);



for i = 1:1:9
   torque = [torque ; torque_];
end

time = 0:0.04:(length(torque)*2-1)/50;
time_2 = 0:0.04:(length(torque_)*2-1)/50;

%% CREATE A POLYNOMIAL and/or SINE WAVE
% f(x) = a1*sin(b1*x+c1) + a2*sin(b2*x+c2) + a3*sin(b3*x+c3) + 
%        a4*sin(b4*x+c4) + a5*sin(b5*x+c5) + a6*sin(b6*x+c6) + 
%        a7*sin(b7*x+c7) + a8*sin(b8*x+c8)
[siny, gof] = sine_fit(time, torque);
a1 = siny.a1; b1 = siny.b1; c1 = siny.c1;
a2 = siny.a2; b2 = siny.b2; c2 = siny.c2;
a3 = siny.a3; b3 = siny.b3; c3 = siny.c3;
%a4 = siny.a4; b4 = siny.b4; c4 = siny.c4;
%a5 = siny.a5; b5 = siny.b5; c5 = siny.c5;
%a6 = siny.a6; b6 = siny.b6; c6 = siny.c6;
%a7 = siny.a7; b7 = siny.b7; c7 = siny.c7;
%a8 = siny.a8; b8 = siny.b8; c8 = siny.c8;


for i = 1:1:length(time_2)
   t = time_2(i);
   sine_y(i) = a1*sin(b1*t+c1) + a2*sin(b2*t+c2) + a3*sin(b3*t+c3);% + a4*sin(b4*t+c4) + a5*sin(b5*t+c5) + a6*sin(b6*t+c6) + a7*sin(b7*t+c7) + a8*sin(b8*t+c8);
end

%% PLOT
%plot each equation
figure();
hold on
plot(time_2/1.960*100,torque_) % right leg torque
%plot(gait_r,polynomial_y) % right leg polynomial aproximation
plot(time_2/1.960*100,sine_y) % right leg polynomial aproximation
legend('Healthy Gait Moment','Sinusoidal Fit')
legend('Healthy Gait Moment','Sinusoidal Fit')
xlabel('Gait %','fontsize',20)
ylabel('Torque(N·m)','fontsize',20)
set(gca,'FontSize',20)
hold off



function [fitresult, gof] = poly_fit(gait_r, one_cycle_torque_r)
%% Fit: 'untitled fit 1'.
[xData, yData] = prepareCurveData( gait_r, one_cycle_torque_r );

% Set up fittype and options.
ft = fittype( 'poly4' );

% Fit model to data.
[fitresult, gof] = fit( xData, yData, ft );
%{
% Plot fit with data.
figure( 'Name', 'untitled fit 1' );
h = plot( fitresult, xData, yData );
legend( h, 'one_cycle_torque_r vs. gait_r', 'untitled fit 1', 'Location', 'NorthEast', 'Interpreter', 'none' );
% Label axes
xlabel( 'gait_r', 'Interpreter', 'none' );
ylabel( 'one_cycle_torque_r', 'Interpreter', 'none' );
grid on
%}
end

function [fitresult, gof] = sine_fit(filtered_time_r, filtered_torque_r)
%CREATEFIT3(FILTERED_TIME_R,FILTERED_TORQUE_R)
%  Create a fit.
%
%  Data for 'untitled fit 1' fit:
%      X Input : filtered_time_r
%      Y Output: filtered_torque_r
%  Output:
%      fitresult : a fit object representing the fit.
%      gof : structure with goodness-of fit info.
%
%  See also FIT, CFIT, SFIT.

%  Auto-generated by MATLAB on 18-Apr-2021 11:37:01


%% Fit: 'untitled fit 1'.
[xData, yData] = prepareCurveData( filtered_time_r, filtered_torque_r );

% Set up fittype and options.
ft = fittype( 'sin3' );
opts = fitoptions( 'Method', 'NonlinearLeastSquares' );
opts.Display = 'Off';
opts.Lower = [-Inf 0 -Inf -Inf 0 -Inf -Inf 0 -Inf];
opts.StartPoint = [0.430712731111225 3.14788843045069 -1.87660586443559 0.0931523942521978 9.44366529135208 -2.20157543246415 0.072287959272133 6.29577686090139 2.44198165212433];

% Fit model to data.
[fitresult, gof] = fit( xData, yData, ft, opts );

% Plot fit with data.
%{
figure( 'Name', 'untitled fit 1' );
h = plot( fitresult, xData, yData );
legend( h, 'filtered_torque_r vs. filtered_time_r', 'untitled fit 1', 'Location', 'NorthEast', 'Interpreter', 'none' );
% Label axes
xlabel( 'filtered_time_r', 'Interpreter', 'none' );
ylabel( 'filtered_torque_r', 'Interpreter', 'none' );
grid on
%}
end